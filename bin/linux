USERNAME=$(find /home/* -maxdepth 0 -printf "%f" -type d)
export DEBIAN_FRONTEND=noninteractive

setup() {
  check_is_sudo
  echo "setup..."
  setup_sudo
  install_base_packages
  remove_unneeded_packages
}

# setup sudo for a user
setup_sudo() {
  adduser $USERNAME sudo
}

# remove unneeded packages
remove_unneeded_packages() {
  apt-get remove -y \
    firefox-esr \
    totem
  apt-get autoremove
}

# install base system packages
install_base_packages() {
  release_file="/etc/apt/apt.conf.d/80default-release"
  touch $release_file
  echo 'APT::Default-Release "buster";' >> $release_file
  echo "deb http://httpredir.debian.org/debian/ buster non-free" >> /etc/apt/sources.list
  echo "deb http://httpredir.debian.org/debian/ sid main" >> /etc/apt/sources.list
  apt-get update
  apt-get -y dist-upgrade
  
  apt-get install -y \
          adduser \
          arc-theme \
          curl \
          git \
          htop \
          gnome-core \
          gnome-tweak-tool \
          keepassxc \
          sudo \
          tmux \
          transmission \
          vim-gtk \
          vim-nox \
          vlc \
          xclip \
          --no-install-recommends

  # non-free packages
  apt-get install -y \
          firmware-iwlwifi

  # unstable packages
  apt-get install -y -t sid \
          firefox
}

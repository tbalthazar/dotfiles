#!/bin/bash

USERNAME=$(find /home/* -maxdepth 0 -printf "%f" -type d)
export DEBIAN_FRONTEND=noninteractive

setup() {
  check_is_sudo
  echo "setup..."
  setup_sudo
  install_base_packages
  remove_unneeded_packages
}

# setup sudo for a user
setup_sudo() {
  adduser $USERNAME sudo
}

# remove unneeded packages
remove_unneeded_packages() {
  apt-get remove -y \
    firefox-esr \
    totem
  apt-get autoremove -y
}

# install base system packages
install_base_packages() {
  release_file="/etc/apt/apt.conf.d/80default-release"
  touch $release_file
  echo 'APT::Default-Release "buster";' >> $release_file
  echo "deb http://httpredir.debian.org/debian/ buster non-free" >> /etc/apt/sources.list
  echo "deb http://httpredir.debian.org/debian/ sid main" >> /etc/apt/sources.list
  apt-get update
  apt-get -y dist-upgrade
  
  apt-get install -y \
          adduser \
          arc-theme \
          bluez-firmware \
          curl \
          git \
          gnome-core \
          gnome-tweak-tool \
          htop \
          keepassxc \
          libblockdev-crypto2 \
          network-manager \
          pulseaudio-module-bluetooth \
          sudo \
          tmux \
          transmission \
          vim-gtk \
          vim-nox \
          vlc \
          xclip \
          --no-install-recommends

  # non-free packages
  apt-get install -y \
          firmware-iwlwifi

  # unstable packages
  apt-get install -y -t sid \
          firefox
}

docker() {
  check_is_sudo
  echo "installing Docker..."
  # Install base packages
  apt-get update && apt-get -y upgrade
  apt-get install -y \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg2 \
    software-properties-common

  # Add Dockerâ€™s official GPG key
  curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add -

  # Configure stable repository
  add-apt-repository \
    "deb [arch=amd64] https://download.docker.com/linux/debian \
    $(lsb_release -cs) \
    stable"

  # Install Docker
  apt-get update && apt-get install -y docker-ce

  usermod -aG docker $USERNAME
}
